<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="" />
    <meta
      property="og:description"
      content="hit this website link inside a VR headset!!"
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://smrghsh.github.io/butterfly" />

    <meta
      property="og:image"
      content="https://smrghsh.github.io/butterfly/butterfly-meta.png"
    />
    <title>coral</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap");
    </style>
    <!-- <link rel="icon" href="https://smrghsh.github.io/cgol/icon.gif" type="image/gif"> -->
  </head>
  <body>
    <h1
      id="loading"
      style="
        position: absolute;
        color: white;
        margin: 1em;
        font-family: sans-serif;
      "
    >
      loading...
    </h1>
    <canvas class="webgl"></canvas>
    <main>
      <h1>Coral</h1>
      <h2>A VR Coral Reef Rendering Prototype</h2>
      <p>
        A small point cloud rendering of a coral reef in Indonesia. Used to
        explore how LLMs and AI agents can help us make sense of geospatial data
        in VR. Data and technique from a project by wildflow.ai and Mark
        Kellogg's GuassianSplats3D project.
      </p>
      <a href="https://github.com/smrghsh/coral">Source Code</a> |
      <a
        href="https://huggingface.co/datasets/wildflow/sweet-corals/tree/main/_indonesia_tabuhan_p1_20250210/splats"
        >Coral Dataset</a
      >
      <a href="https://wildflow.ai/">wildflow.ai</a>

      <hr />
      <div id="chat-agent">
        <div class="chat-header">Ask the Agent</div>
        <div class="chat-box">
          <input
            id="chat-input"
            type="text"
            placeholder="Type your question..."
            autocomplete="off"
          />
          <button id="chat-send">Send</button>
        </div>
        <div id="chat-log"></div>
      </div>
    </main>

    <script type="module" src="./script.js"></script>
    <script type="module">
      const chatInput = document.getElementById("chat-input");
      const chatSend = document.getElementById("chat-send");
      const chatLog = document.getElementById("chat-log");

      function addChatMessage(role, text) {
        const msg = document.createElement("div");
        msg.textContent = `${role}: ${text}`;
        msg.style.margin = "0.2em 0";
        chatLog.appendChild(msg);
      }

      async function sendChat() {
        const query = chatInput.value.trim();
        if (!query) return;
        addChatMessage("You", query);
        console.log("User query:", query);
        chatInput.value = "";
        // Call agent and display response below
        if (
          window.experience &&
          window.experience.world &&
          window.experience.world.agent
        ) {
          addChatMessage("Agent", "..."); // show loading
          try {
            const response = await window.experience.world.agent.ask(query);
            // Remove last 'Agent: ...' loading message
            chatLog.lastChild.textContent = `Agent: ${response}`;
            console.log("Agent response:", response);
          } catch (err) {
            chatLog.lastChild.textContent = `Agent: Error`;
            console.error("Agent error:", err);
          }
        } else {
          addChatMessage("Agent", "Agent not available");
        }
      }

      chatSend.addEventListener("click", sendChat);
      chatInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          sendChat();
        }
      });
    </script>
  </body>
</html>
